{% extends "base.html" %}

{% block title %}Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù - Admin Panel{% endblock %}

{% block content %}
<div class="container" style="margin-top: 80px;">
    
    <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1>ğŸ›ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù</h1>
                    <p class="text-muted mb-0">Ø¥Ø¯Ø§Ø±Ø© ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¹Ø¨Ø± Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</p>
                </div>
                <div>
                    <a href="/advanced-analyzer" class="btn btn-gradient-purple me-2" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; color: white;">
                        <i class="fas fa-chart-area"></i> Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
                    </a>
                    <a href="/forex-analyzer" class="btn btn-info me-2">
                        <i class="fas fa-chart-line"></i> Ù…Ø­Ù„Ù„ Ø§Ù„ÙÙˆØ±ÙƒØ³
                    </a>
                    <a href="/subscriptions-management" class="btn btn-success me-2">
                        <i class="fas fa-users-cog"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
                    </a>
                    <a href="/admin-management" class="btn btn-warning me-2">
                        <i class="fas fa-user-shield"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
                    </a>
                    <a href="/bot-management" class="btn btn-primary">
                        <i class="fas fa-robot"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙˆØªØ§Øª
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-icon">ğŸ‘¥</div>
                <div class="stat-value">{{ stats.total_users }}</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-icon">âœ…</div>
                <div class="stat-value">{{ stats.active_users }}</div>
                <div class="stat-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-value">{{ stats.total_signals }}</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-icon">ğŸ¯</div>
                <div class="stat-value">{{ stats.total_recommendations }}</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆØµÙŠØ§Øª</div>
            </div>
        </div>
    </div>

    <!-- Tabs Ù„Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
    <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="signals-tab" data-bs-toggle="tab" data-bs-target="#signals" type="button">
                ğŸ“Š Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="recommendations-tab" data-bs-toggle="tab" data-bs-target="#recommendations" type="button">
                ğŸ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆØµÙŠØ§Øª
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports" type="button">
                ğŸ“‹ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="broadcast-tab" data-bs-toggle="tab" data-bs-target="#broadcast" type="button">
                ğŸ“¢ Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ù…Ø©
            </button>
        </li>
    </ul>

    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù€ Tabs -->
    <div class="tab-content" id="adminTabsContent">
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª -->
        <div class="tab-pane fade show active" id="signals" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ“Š Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">Ø§Ø®ØªØ± Ø¥Ø´Ø§Ø±Ø© Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</p>
                    
                    <div id="signals-list">
                        {% if recent_signals %}
                            {% for signal in recent_signals %}
                            <div class="signal-item mb-3 p-3 border rounded">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        {% set sig_symbol = signal.get('symbol', signal.get('pair', 'N/A')) %}
                                        {% set sig_action = signal.get('rec', signal.get('signal', '')) %}
                                        <h6>
                                            <span class="badge bg-primary">{{ sig_symbol }}</span>
                                            <span class="badge bg-{{ 'success' if sig_action|lower == 'buy' else 'danger' }}">
                                                {{ sig_action|upper if sig_action else 'N/A' }}
                                            </span>
                                            <span class="badge bg-info">â­ {{ signal.get('quality_score', 'N/A') }}</span>
                                        </h6>
                                        <small class="text-muted">
                                            Entry: {{ signal.get('entry', 'N/A') }} | SL: {{ signal.get('sl', 'N/A') }} | 
                                            TP1: {{ signal.get('tp1', 'N/A') }} | TF: {{ signal.get('tf', signal.get('timeframe', 'N/A')) }}
                                        </small>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <button class="btn btn-primary btn-sm send-signal-btn" 
                                                data-signal-id="{{ signal.file }}">
                                            ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="alert alert-info">
                                Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø§Ø±Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙˆØµÙŠØ§Øª -->
        <div class="tab-pane fade" id="recommendations" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø¥Ù„Ù‰ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">Ø§Ø®ØªØ± ØªÙˆØµÙŠØ© Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</p>
                    
                    <div id="recommendations-list">
                        {% if recent_recommendations %}
                            {% for rec in recent_recommendations %}
                            <div class="signal-item mb-3 p-3 border rounded">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h6>
                                            <span class="badge bg-primary">{{ rec.pair }}</span>
                                            {% set rec_signal = rec.get('signal', rec.get('action', '')) %}
                                            <span class="badge bg-{{ 'success' if rec_signal|lower == 'buy' else 'danger' }}">
                                                {{ rec_signal|upper if rec_signal else 'N/A' }}
                                            </span>
                                            <span class="badge bg-info">â­ {{ rec.get('quality_score', rec.get('confidence', 'N/A')) }}</span>
                                        </h6>
                                        <small class="text-muted">
                                            Entry: {{ rec.get('entry', 'N/A') }} | SL: {{ rec.get('sl', 'N/A') }} | 
                                            TP1: {{ rec.get('tp1', 'N/A') }} | TF: {{ rec.get('timeframe', 'N/A') }}
                                        </small>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <button class="btn btn-primary btn-sm send-recommendation-btn" 
                                                data-rec-index="{{ loop.index0 }}">
                                            ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="alert alert-info">
                                Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØµÙŠØ§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
        <div class="tab-pane fade" id="reports" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ“‹ Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="report-type" class="form-label">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                        <select class="form-select" id="report-type">
                            <option value="custom">ØªÙ‚Ø±ÙŠØ± Ù…Ø®ØµØµ</option>
                            <option value="daily">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</option>
                            <option value="weekly">ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
                            <option value="performance">ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="report-text" class="form-label">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                        <textarea class="form-control" id="report-text" rows="8" 
                                  placeholder="Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù‡Ù†Ø§...

Ù…Ø«Ø§Ù„:
âœ… Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø§Ø¬Ø­Ø©: 15
âŒ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø®Ø§Ø³Ø±Ø©: 3
ğŸ“ˆ Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: 83%
ğŸ’° Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: +450 Ù†Ù‚Ø·Ø©"></textarea>
                    </div>
                    
                    <button class="btn btn-success" id="send-report-btn">
                        ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                    </button>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© -->
        <div class="tab-pane fade" id="broadcast" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ù…Ø©</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <strong>ØªÙ†Ø¨ÙŠÙ‡:</strong> Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† ({{ stats.active_users }} Ù…Ø³ØªØ®Ø¯Ù…)
                    </div>
                    
                    <div class="mb-3">
                        <label for="broadcast-message" class="form-label">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                        <textarea class="form-control" id="broadcast-message" rows="6" 
                                  placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...

Ù…Ø«Ø§Ù„:
ğŸ‰ Ø¹Ø±Ø¶ Ø®Ø§Øµ Ù„ÙØªØ±Ø© Ù…Ø­Ø¯ÙˆØ¯Ø©!

Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®ØµÙ… 50% Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
Ø§Ø³ØªØ®Ø¯Ù… ÙƒÙˆØ¯: SPECIAL50

â° Ø§Ù„Ø¹Ø±Ø¶ ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯ 48 Ø³Ø§Ø¹Ø©"></textarea>
                    </div>
                    
                    <button class="btn btn-warning" id="send-broadcast-btn">
                        ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ù…ÙŠØ¹
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <div id="result-area" class="mt-4" style="display: none;">
        <div class="alert" id="result-message"></div>
    </div>

</div>

<style>
.stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    padding: 20px;
    color: white;
    text-align: center;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-icon {
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.stat-value {
    font-size: 2rem;
    font-weight: bold;
    margin: 10px 0;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.9;
}

.signal-item {
    background: #f8f9fa;
    transition: all 0.3s ease;
}

.signal-item:hover {
    background: #e9ecef;
    transform: translateX(5px);
}

.nav-tabs .nav-link {
    color: #667eea;
    font-weight: 500;
}

.nav-tabs .nav-link.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
}

.card {
    border: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-radius: 10px;
}

.card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 10px 10px 0 0 !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø§Ø±Ø©
    document.querySelectorAll('.send-signal-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const signalId = this.getAttribute('data-signal-id');
            const originalText = this.textContent;
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†ØŸ')) {
                return;
            }
            
            this.disabled = true;
            this.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
            
            fetch('/api/admin/send-signal', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ signal_id: signalId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showResult('success', `âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!
                        ğŸ“Š ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${data.sent_count}
                        âŒ ÙØ´Ù„: ${data.failed_count}
                        ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${data.total_subscribers}`);
                    this.textContent = 'âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„';
                    this.classList.remove('btn-primary');
                    this.classList.add('btn-success');
                } else {
                    showResult('danger', 'âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + data.error);
                    this.disabled = false;
                    this.textContent = originalText;
                }
            })
            .catch(error => {
                showResult('danger', 'âŒ Ø®Ø·Ø£: ' + error);
                this.disabled = false;
                this.textContent = originalText;
            });
        });
    });
    
    // Ø¥Ø±Ø³Ø§Ù„ ØªÙˆØµÙŠØ©
    document.querySelectorAll('.send-recommendation-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const recIndex = this.getAttribute('data-rec-index');
            const originalText = this.textContent;
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„ØªÙˆØµÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†ØŸ')) {
                return;
            }
            
            this.disabled = true;
            this.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
            
            fetch('/api/admin/send-recommendation', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ recommendation_id: recIndex })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showResult('success', `âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!
                        ğŸ“Š ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${data.sent_count}
                        âŒ ÙØ´Ù„: ${data.failed_count}
                        ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${data.total_subscribers}`);
                    this.textContent = 'âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„';
                    this.classList.remove('btn-primary');
                    this.classList.add('btn-success');
                } else {
                    showResult('danger', 'âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + data.error);
                    this.disabled = false;
                    this.textContent = originalText;
                }
            })
            .catch(error => {
                showResult('danger', 'âŒ Ø®Ø·Ø£: ' + error);
                this.disabled = false;
                this.textContent = originalText;
            });
        });
    });
    
    // Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±
    document.getElementById('send-report-btn').addEventListener('click', function() {
        const reportText = document.getElementById('report-text').value.trim();
        const reportType = document.getElementById('report-type').value;
        
        if (!reportText) {
            showResult('warning', 'âš ï¸ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
            return;
        }
        
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†ØŸ')) {
            return;
        }
        
        this.disabled = true;
        this.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
        
        fetch('/api/admin/send-report', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ 
                report_text: reportText,
                report_type: reportType
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showResult('success', `âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!
                    ğŸ“Š ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${data.sent_count}
                    âŒ ÙØ´Ù„: ${data.failed_count}
                    ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${data.total_subscribers}`);
                document.getElementById('report-text').value = '';
                this.disabled = false;
                this.textContent = 'ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±';
            } else {
                showResult('danger', 'âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + data.error);
                this.disabled = false;
                this.textContent = 'ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±';
            }
        })
        .catch(error => {
            showResult('danger', 'âŒ Ø®Ø·Ø£: ' + error);
            this.disabled = false;
            this.textContent = 'ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±';
        });
    });
    
    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ù…Ø©
    document.getElementById('send-broadcast-btn').addEventListener('click', function() {
        const message = document.getElementById('broadcast-message').value.trim();
        
        if (!message) {
            showResult('warning', 'âš ï¸ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©');
            return;
        }
        
        if (!confirm('âš ï¸ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
            return;
        }
        
        this.disabled = true;
        this.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
        
        fetch('/api/admin/broadcast-message', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: message })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showResult('success', `âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!
                    ğŸ“Š ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${data.sent_count}
                    âŒ ÙØ´Ù„: ${data.failed_count}
                    ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${data.total_subscribers}`);
                document.getElementById('broadcast-message').value = '';
                this.disabled = false;
                this.textContent = 'ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ù…ÙŠØ¹';
            } else {
                showResult('danger', 'âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + data.error);
                this.disabled = false;
                this.textContent = 'ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ù…ÙŠØ¹';
            }
        })
        .catch(error => {
            showResult('danger', 'âŒ Ø®Ø·Ø£: ' + error);
            this.disabled = false;
            this.textContent = 'ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ù…ÙŠØ¹';
        });
    });
    
    function showResult(type, message) {
        const resultArea = document.getElementById('result-area');
        const resultMessage = document.getElementById('result-message');
        
        resultMessage.className = `alert alert-${type}`;
        resultMessage.innerHTML = message.replace(/\n/g, '<br>');
        resultArea.style.display = 'block';
        
        // Scroll to result
        resultArea.scrollIntoView({ behavior: 'smooth' });
        
        // Hide after 10 seconds
        setTimeout(() => {
            resultArea.style.display = 'none';
        }, 10000);
    }
});
</script>

{% endblock %}
